set backspace=indent,eol,start
set cursorline
set colorcolumn=+1
set encoding=utf8
set keymodel=startsel
set laststatus=2
set mouse=a
set nobackup
set nocompatible
set noshowmode
set noswapfile
set nowrap
set nowritebackup
set number
set numberwidth=3
set previewheight=5
set showtabline=0
set textwidth=1024

" cursor shape
let &t_SI="\<Esc>[4 q"
let &t_EI="\<Esc>[2 q"

" leader key
let mapleader="\<Space>"

" tabs
set autoindent
set expandtab
set shiftwidth=2
set softtabstop=2
set tabstop=2

" whitespace characters
set listchars=space:·,tab:»\ ,trail:·
set list
set nolist

" complete popup
set completeopt=menuone,popuphidden,noinsert,noselect
set completepopup=highlight:Pmenu,border:on,width:30,height:15

" enable reading .vimrc from the current directory
set exrc

" disable bell sounds
set belloff=all

" syntax highlighting
syntax on
filetype plugin indent on

" omnisharp
let g:OmniSharp_server_use_net6=1
let g:OmniSharp_server_stdio=1

" asynccomplete
let g:asyncomplete_auto_popup=1

" vim-lsp-settings
let g:lsp_document_code_action_signs_enabled=0

" fzf
let g:fzf_vim={}
let g:fzf_vim.command_prefix='Fzf'

" lightline
let g:lightline={
                  \ 'colorscheme': 'snazzy',
                  \ 'active': {
                  \   'left': [ [ 'mode' ], [ 'filename' ] ],
                  \   'right': [ [ 'lineinfo' ] ]
                  \ },
                  \ 'component': {
                  \   'charvaluehex': '0x%B'
                  \ },
                  \ }

" vim-plug
call plug#begin('~/.vim/plug-plugins')

" show trailing whitespace
Plug 'bronson/vim-trailing-whitespace'

" theme
Plug 'connorholyday/vim-snazzy'

" editorconfig support
Plug 'editorconfig/editorconfig-vim'

" custom statusline
Plug 'itchyny/lightline.vim'

" language packs
Plug 'sheerun/vim-polyglot'

" fzf integration
Plug 'junegunn/fzf', {'do': { -> fzf#install() }}
Plug 'junegunn/fzf.vim'

" lsp
Plug 'prabirshrestha/vim-lsp'
Plug 'mattn/vim-lsp-settings'

" asyncomplete.vim
Plug 'prabirshrestha/asyncomplete.vim'
Plug 'prabirshrestha/asyncomplete-lsp.vim'

" code formatting
Plug 'vim-autoformat/vim-autoformat'

call plug#end()

autocmd VimEnter *
                  \  if len(filter(values(g:plugs), '!isdirectory(v:val.dir)'))
                  \|   PlugInstall --sync | q
                  \| endif

" theme
try
      colorscheme snazzy
catch
endtry

" buffer keymaps
nnoremap <silent> <Tab>      :bn<CR>
nnoremap <silent> <S-Tab>    :bp<CR>
nnoremap <silent> <Leader>bd :bd<CR>

" window keymaps
nnoremap <silent> <C-w>c  <C-w>c
nnoremap <silent> <C-w>h  :<C-u>split<CR>
nnoremap <silent> <C-w>v  :<C-u>vsplit<CR>

" use enter to clear last search highlighting
nnoremap <silent> <CR> :noh<CR><CR>

" fzf keymap
nnoremap <silent> <Leader>f  :call fzf#vim#files('')<CR>
nnoremap <silent> <Leader>F  :call fzf#vim#files(expand('%:p:h'))<CR>
nnoremap <silent> <Leader>gf :call fzf#vim#gitfiles('')<CR>
nnoremap <silent> <Leader>gs :call fzf#vim#gitfiles('?')<CR>
nnoremap <silent> <Leader><tab> <Plug>(fzf-maps-n)
xnoremap <silent> <Leader><tab> <Plug>(fzf-maps-x)
onoremap <silent> <Leader><tab> <Plug>(fzf-maps-o)

" vim-lsp keymaps
nnoremap <silent> [[ <Plug>(lsp-previous-reference)
nnoremap <silent> ]] <Plug>(lsp-next-reference)
nnoremap <silent> <Leader>gd <Plug>(lsp-definition)
nnoremap <silent> <Leader>fs <Plug>(lsp-document-symbol-search)
nnoremap <silent> <Leader>fS <Plug>(lsp-workspace-symbol-search)
nnoremap <silent> <Leader>fu <Plug>(lsp-references)
nnoremap <silent> <Leader>ca <Plug>(lsp-code-action)
nnoremap <silent> <Leader>r  <Plug>(lsp-rename)
nnoremap <silent> <Leader>d  <Plug>(lsp-hover)

" save after leaving insert mode
autocmd InsertLeave *
                  \ if &buftype ==# '' || &buftype == 'acwrite'
                  \|     silent write
                  \| endif

" reset kitty padding
autocmd VimEnter * execute 'silent! !kitten @ set-spacing padding=0'
autocmd VimLeave * execute 'silent! !kitten @ set-spacing padding=5'

